<!DOCTYPE html>
<html lang="monkeyy">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CTB Loadout Generator!</title>
  <style>
    html, body { 
      margin: 0; 
      padding: 0; 
      height: 100%; 
      width: 100%; 
      overflow: hidden; 
      color: #fff; 
    }
    body { 
      font-family: Arial, sans-serif; 
      transform: scale(0.9);
      transform-origin: 0 0;
      width: 111.11%;
      height: 111.11%;
    }
    html, body, * { cursor: url('asset/cursorlol.png') 8 2, url('asset/cursorlol.cur'), auto; }
    html, body, * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    *:focus { outline: none !important; }
    button, .thumb { cursor: url('asset/cursorlol.png') 8 2, pointer; }
    @font-face {
      font-family: 'Sarpanch';
      src: url('Sarpanch.ttf') format('truetype');
      font-weight: 400; font-style: normal; font-display: swap;
    }
    #bg-video { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 1; filter: brightness(0.5) contrast(1.05); }
    .logo { position: absolute; top: 16px; right: 16px; left: auto; z-index: 3; }
    .logo img { width: 260px; height: auto; display: block; }
    .panel { position: absolute; top: 80px; left: 20px; right: 20px; z-index: 2; max-width: calc(100% - 40px); }
    .glass {
      background: rgba(0, 0, 0, 0.78);
      backdrop-filter: blur(1px);
      padding: 18px; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      width: max-content;
    }
    .loadout-title { display: block; width: auto; height: 36px; margin: 0 0 8px 0; user-select: none; -webkit-user-drag: none; }
    .container { display: flex; flex-direction: row; gap: 16px; }
    .image-box { position: relative; width: 168px; height: 168px; background: #000; border: 2px solid #ffffff; border-radius: 14px; display: flex; align-items: center; justify-content: center; overflow: hidden; transition: transform 140ms ease, border-color 140ms ease, box-shadow 140ms ease; }
    .image-box img { max-width: 100%; max-height: 100%; user-select: none; -webkit-user-drag: none; pointer-events: none; }
    .image-box:hover { transform: scale(1.06); border-color: #1e90ff; box-shadow: 0 8px 20px rgba(30,144,255,0.35); }
    .caption { position: absolute; left: 0; right: 0; bottom: 0; padding: 6px 8px; background: linear-gradient(to top, rgba(0,0,0,0.75), rgba(0,0,0,0.0)); text-align: center; font-family: 'Sarpanch', Arial, sans-serif; font-size: 14px; opacity: 0; transform: translateY(6px); transition: opacity 140ms ease, transform 140ms ease; pointer-events: none; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
    .image-box:hover .caption { opacity: 1; transform: translateY(0); }
    .generate-wrap { margin-top: 14px; width: max-content; display: flex; align-items: center; gap: 10px; }
    .generate-btn { display: inline-block; background: none; border: none; padding: 0; }
    .generate-btn img { width: 280px; height: auto; display: block; user-select: none; -webkit-user-drag: none; }
    .generate-btn.pulse img { animation: genpress 160ms ease; }
    @keyframes genpress { 0%{transform:scale(1)} 50%{transform:scale(0.94)} 100%{transform:scale(1)} }
    .toggle-btn { font-family: 'Sarpanch', Arial, sans-serif; font-size: 16px; padding: 6px 10px; background: transparent; border: 1px solid #fff; border-radius: 0; color: #fff; }
    .section-title { margin: 10px 0 6px 4px; display: block; width: auto; height: 28px; }
    .filter-panel { margin-top: 6px; }
    .filter-grid { display: grid; gap: 8px; }
    .filter-grid.regular { grid-template-columns: repeat(6, 56px); }
    .filter-grid.exclusive { grid-template-columns: repeat(6, 48px); }
    .filter-grid.golden { grid-template-columns: repeat(6, 48px); }
    .thumb { width: 56px; height: 56px; border: 2px solid transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #000; position: relative; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; user-select: none; -webkit-user-drag: none; }
    .thumb.selected { border-color: #29c24a; }
    .thumb:not(.selected)::after { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.45); }
    .filter-grid.exclusive .thumb, .filter-grid.golden .thumb { width: 48px; height: 48px; }
    .hint { margin-top: 8px; margin-left: 4px; font-size: 13px; color: #ffb3b3; display: none; }
    .hint.flash { animation: flashmsg 0.5s alternate 6; }
    @keyframes flashmsg { from { color: red; } to { color: white; } }
    .bottom-right { position: absolute; right: 20px; bottom: 80px; z-index: 2; }
    .bottom-right .glass { width: 320px; padding: 12px; }
    .credits-img { display: block; width: 100%; height: auto; margin-bottom: 8px; user-select: none; -webkit-user-drag: none; }
    .discord-skibidi { display: block; margin-bottom: 8px; color: #8fd1ff; text-decoration: underline; cursor: pointer; user-select: none; }
    .placeholder-frame { background: rgba(0,0,0,0.65); border-radius: 8px; padding: 8px; max-height: 140px; overflow-y: auto; font-size: 13px; color: #eee; }
    .legacy-poopy-version {
      position: absolute;
      right: 20px;
      bottom: 20px;
      z-index: 3;
      color: #8fd1ff;
      text-decoration: none;
      background: none;
      padding: 0;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    @media (max-width: 980px) { .container { flex-wrap: wrap; } }
  </style>
</head>
<body>
  <div id="scale">
    <video id="bg-video" autoplay loop muted playsinline>
      <source src="asset/bgvfx.mp4" type="video/mp4" />
    </video>
    <div class="logo"><img src="asset/logomain.png" alt="Site Logo" /></div>
    <div class="panel">
      <div class="glass">
        <img class="loadout-title" src="asset/text_loadout.png" alt="Loadout" />
        <div class="container" id="image-container">
          <div class="image-box" id="box1"><div class="caption"></div></div>
          <div class="image-box" id="box2"><div class="caption"></div></div>
          <div class="image-box" id="box3"><div class="caption"></div></div>
          <div class="image-box" id="box4"><div class="caption"></div></div>
          <div class="image-box" id="box5"><div class="caption"></div></div>
        </div>
        <div class="generate-wrap">
          <button class="generate-btn" id="generate" aria-label="Generate Loadout">
            <img src="interact/generate.jpg" alt="Generate" draggable="false" />
          </button>
          <button class="toggle-btn" id="toggle-golden">Golden?</button>
          <button class="toggle-btn" id="toggle-exclusive">Exclusive?</button>
        </div>
        <div id="msg" class="hint">Select at least 5 images across filters to generate a full set.</div>
      </div>
      <img class="section-title" src="asset/text_filter.png" alt="Filter" />
      <div class="glass filter-panel">
        <div id="regular-grid" class="filter-grid regular"></div>
      </div>
      <img class="section-title" src="asset/text_exclusive.png" alt="Exclusive" />
      <div class="glass filter-panel">
        <div id="exclusive-grid" class="filter-grid exclusive"></div>
      </div>
      <img class="section-title" src="asset/text_golden.png" alt="Golden" />
      <div class="glass filter-panel">
        <div id="golden-grid" class="filter-grid golden"></div>
      </div>
    </div>
    <div class="bottom-right">
      <div class="glass">
        <img src="asset/credits.png" alt="Credits" class="credits-img" draggable="false" />
        <a id="discord-skibidi" class="discord-skibidi" href="https://discord.gg/J48ksyNv2w" target="_blank" rel="noopener noreferrer">Join the Discord server!</a>
        <div class="placeholder-frame" id="placeholder-frame">
          <p><strong>CHANGELOG:</strong></p>
          <p>Thank you for using the CTB Loadout Generator! Old legacy version is linked below.</p>
          <p>Recoded the site so it works on a static webpage, no longer needs time to fetch images.</p>
          <p>Improved UI with glass panels, removed TB mode, portrait mode and classic mode.</p>
          <p>Added a custom filter selector located right below the loadout row, allowing you to make your own filter. Generic buttons were kept.</p>
          <p>Way better browser scaling.</p>
          <p>Added Slugger, removed Tweeter.</p>
          <p>Overall more responsive, more graphic.</p>
        </div>
      </div>
    </div>
    <a id="legacy-poopy-version" class="legacy-poopy-version" href="https://example.com/legacy" style="position:absolute; right:20px; bottom:20px; z-index:3;" target="/legacy/index.html" rel="noopener noreferrer">Legacy (Old) Version</a>
    <audio id="gen-sound" src="asset/gen.ogg" preload="auto"></audio>
  </div>
  <script>
    const exts = ['.png', '.jpg', '.jpeg', '.gif', '.webp'];
    const nameFromUrl = (url) => (url.split('/').pop() || '').replace(/\.[^.]+$/, '');
    const CATS = {
      regular: { path: 'tower/regular', grid: 'regular-grid', defaultOn: true },
      exclusive: { path: 'tower/exclusive', grid: 'exclusive-grid', defaultOn: false },
      golden: { path: 'tower/golden', grid: 'golden-grid', defaultOn: false },
    };
    const selected = { regular: new Set(), exclusive: new Set(), golden: new Set() };
    const catalog = { regular: [], exclusive: [], golden: [] };
    function playSound(path, volume = 1.0) {
      try {
        const a = new Audio(path);
        a.volume = typeof volume === 'number' ? Math.max(0, Math.min(1, volume)) : 1.0;
        a.play().catch(()=>{});
      } catch (e) {}
    }
    async function loadManifest(folder) {
      const url = `${folder}/manifest.json`;
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error(`${url} ${res.status}`);
        const arr = await res.json();
        return arr
          .filter((n) => exts.some((e) => n.toLowerCase().endsWith(e)))
          .map((n) => (n.startsWith(folder + '/') ? n : `${folder}/${n}`));
      } catch (e) {
        const guesses = [];
        for (let i = 1; i <= 50; i++) {
          ['png', 'jpg', 'jpeg', 'webp', 'gif'].forEach((ext) => guesses.push(`${folder}/${i}.${ext}`));
        }
        const checks = await Promise.allSettled(guesses.map((g) => fetch(g, { method: 'HEAD' })));
        return checks.map((r, i) => (r.status === 'fulfilled' && r.value.ok ? guesses[i] : null)).filter(Boolean);
      }
    }
    function renderGrid(cat, list) {
      const grid = document.getElementById(CATS[cat].grid);
      grid.innerHTML = '';
      list.forEach((src) => {
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        const img = document.createElement('img');
        img.src = src; img.alt = nameFromUrl(src);
        img.draggable = false;
        img.addEventListener('dragstart', (e) => e.preventDefault());
        thumb.appendChild(img);
        const isOn = CATS[cat].defaultOn;
        if (isOn) selected[cat].add(src); else selected[cat].delete(src);
        thumb.classList.toggle('selected', isOn);
        thumb.addEventListener('click', () => {
          if (selected[cat].has(src)) {
            selected[cat].delete(src);
            thumb.classList.remove('selected');
            playSound('asset/woosh.ogg', 0.5);
          } else {
            selected[cat].add(src);
            thumb.classList.add('selected');
            if (cat === 'golden') {
              playSound('asset/GOLDENPOWERRR.ogg', 0.5);
            } else {
              playSound('asset/click.ogg');
            }
          }
        });
        grid.appendChild(thumb);
      });
    }
    async function initFilters() {
      for (const cat of Object.keys(CATS)) {
        const list = await loadManifest(CATS[cat].path);
        catalog[cat] = list;
        renderGrid(cat, list);
      }
    }
    function poolFromSelection() {
      return [ ...selected.regular, ...selected.exclusive, ...selected.golden ];
    }
    function pickUnique(arr, n) {
      if (arr.length <= n) return arr.slice(0, n);
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy.slice(0, n);
    }
    async function generate() {
      document.getElementById('generate').classList.add('pulse');
      setTimeout(() => document.getElementById('generate').classList.remove('pulse'), 170);
      playSound('asset/gen.ogg');
      const msg = document.getElementById('msg');
      const pool = poolFromSelection();
      if (pool.length < 5) { 
        msg.style.display = 'block';
        msg.classList.remove('flash'); void msg.offsetWidth; msg.classList.add('flash');
        playSound('asset/error.ogg');
        setTimeout(() => { msg.style.display = 'none'; msg.classList.remove('flash'); }, 2000);
        return;
      } else {
        msg.style.display = 'none';
        msg.classList.remove('flash');
      }
      const chosen = pickUnique(pool, 5);
      chosen.forEach((src, i) => {
        const box = document.getElementById(`box${i + 1}`);
        const name = nameFromUrl(src);
        box.innerHTML = '';
        const img = document.createElement('img');
        img.src = src; img.alt = name; img.draggable = false;
        img.addEventListener('dragstart', (e)=>e.preventDefault());
        const cap = document.createElement('div');
        cap.className = 'caption';
        cap.textContent = name;
        box.appendChild(img);
        box.appendChild(cap);
      });
    }
    document.getElementById('generate').addEventListener('click', generate);
    document.getElementById('toggle-golden').addEventListener('click', () => {
      const list = catalog.golden;
      if (!list.length) return;
      const allOn = list.every(src => selected.golden.has(src));
      list.forEach(src => {
        if (allOn) selected.golden.delete(src); else selected.golden.add(src);
      });
      const grid = document.getElementById('golden-grid');
      Array.from(grid.children).forEach(el => el.classList.toggle('selected', !allOn));
      playSound('asset/click.ogg');
      if (!allOn) {
        playSound('asset/GOLDENPOWERRR.ogg', 0.5);
      }
    });
    document.getElementById('toggle-exclusive').addEventListener('click', () => {
      const list = catalog.exclusive;
      if (!list.length) return;
      const allOn = list.every(src => selected.exclusive.has(src));
      list.forEach(src => {
        if (allOn) selected.exclusive.delete(src); else selected.exclusive.add(src);
      });
      const grid = document.getElementById('exclusive-grid');
      Array.from(grid.children).forEach(el => el.classList.toggle('selected', !allOn));
      playSound('asset/click.ogg');
    });
    document.addEventListener('dragstart', (e) => e.preventDefault());
    window.addEventListener('DOMContentLoaded', initFilters);
  </script>
</body>
</html>